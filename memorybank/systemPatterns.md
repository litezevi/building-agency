# System Patterns: Building Agency

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```
/app           ‚Üí Next.js App Router (—Å—Ç—Ä–∞–Ω–∏—Ü—ã)
/components    ‚Üí React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ç–æ–ª—å–∫–æ ApartmentPool)
/data          ‚Üí –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (apartments.ts - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑ —á–µ—Ä—Ç–µ–∂–µ–π)
/types         ‚Üí TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
/lib           ‚Üí –£—Ç–∏–ª–∏—Ç—ã (cn = clsx + tailwind-merge)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
**–û–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –æ–¥–Ω–∞ —Å–µ–∫—Ü–∏—è:**
- `page.tsx` ‚Üí —Ç–æ–ª—å–∫–æ ApartmentPool
- –í–µ—Å—å —Å–∞–π—Ç ‚Äî —Å—Ö–µ–º–∞ –∫–≤–∞—Ä—Ç–∏—Ä —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Å–µ–∫—Ü–∏–π –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —á–µ—Ä—Ç–µ–∂–µ–π

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `ApartmentPool.tsx` ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è (self-contained)
- `ui/Button.tsx` ‚Äî –¥–ª—è —Ñ–æ—Ä–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ–¥–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- **–î–∞–Ω–Ω—ã–µ**: `/data/apartments.ts` ‚Üí FloorPlan[] (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —á–µ—Ä—Ç–µ–∂–µ–π)
- **–ß–µ—Ä—Ç–µ–∂–∏**: `/data/apartments.ts` ‚Üí sectionImages (–º–∞–ø–ø–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –∫ —Å–µ–∫—Ü–∏—è–º)
- **–¢–∏–ø—ã**: `/types/apartment.ts` ‚Üí Apartment, FloorPlan, Section, ApartmentClass
- **–õ–æ–≥–∏–∫–∞**: `/components/ApartmentPool.tsx`
- **–ß–µ—Ä—Ç–µ–∂–∏ (—Ñ–∞–π–ª—ã)**: `/public/schemaImages/*.png` (22 –ø–ª–∞–Ω–∞, –∫–æ–ø–∏—è –∏–∑ `/plan-zdaniya/`)
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: `/plan-zdaniya/context.md` (—Ä–∞–∑–±–æ—Ä —á–µ—Ä—Ç–µ–∂–µ–π)

### –ö–ª—é—á–µ–≤—ã–µ —Ç–∏–ø—ã
```typescript
// –ö–ª–∞—Å—Å—ã –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–µ (–∏–∑ —á–µ—Ä—Ç–µ–∂–µ–π)
type ApartmentClass = "–ê" | "–ë" | "–í" | "–ì"

// –°—Ç–∞—Ç—É—Å ‚Äî —Ç–æ–ª—å–∫–æ 2 –∑–Ω–∞—á–µ–Ω–∏—è
type ApartmentStatus = "free" | "sold"

// –í—Å–µ 12 —Å–µ–∫—Ü–∏–π –∑–¥–∞–Ω–∏—è
type Section = "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" | "10" | "11" | "12"

// –ú–∞–ø–ø–∏–Ω–≥ —á–µ—Ä—Ç–µ–∂–µ–π
interface SectionImages {
  firstFloor: string;   // –ø—É—Ç—å –∫ –ø–ª–∞–Ω—É 1 —ç—Ç–∞–∂–∞
  typicalFloor: string; // –ø—É—Ç—å –∫ –ø–ª–∞–Ω—É —Ç–∏–ø–æ–≤–æ–≥–æ —ç—Ç–∞–∂–∞
}

interface Apartment {
  id: string;           // format: "section-floor-number" e.g., "1-5-3"
  number: string;       // –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–∞ —ç—Ç–∞–∂–µ
  floor: number;        // 1-15
  rooms: 1 | 2;         // 1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∏–ª–∏ 2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è
  area: number;         // –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å –∏–∑ —á–µ—Ä—Ç–µ–∂–∞
  price: number;        // area √ó 130000
  status: ApartmentStatus;
  section: Section;     // 1-12
  apartmentClass: ApartmentClass;  // –∫–ª–∞—Å—Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
  livingArea: number;   // –∂–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å –∏–∑ —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏–∏
  kitchenArea: number;  // –ø–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏ –∏–∑ —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏–∏
}

interface FloorPlan {
  floor: number;
  section: Section;
  apartments: Apartment[];
}
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ–∫—Ü–∏–π
```typescript
// –ò–∑ —á–µ—Ä—Ç–µ–∂–µ–π:
- –£–∑–∫–∏–µ —Å–µ–∫—Ü–∏–∏ (5 –∫–≤/—ç—Ç–∞–∂): 1, 6, 9, 10
- –®–∏—Ä–æ–∫–∏–µ —Å–µ–∫—Ü–∏–∏ (6 –∫–≤/—ç—Ç–∞–∂): 2, 3, 4, 5, 7, 8, 11, 12
```

## UI –ü–∞—Ç—Ç–µ—Ä–Ω—ã

### –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
| –°—Ç–∞—Ç—É—Å | –¶–≤–µ—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|----------|
| free | üü¢ –∑–µ–ª—ë–Ω—ã–π | –°–≤–æ–±–æ–¥–Ω–æ (–¥–æ—Å—Ç—É–ø–Ω–∞) |
| sold | üî¥ –∫—Ä–∞—Å–Ω—ã–π | –ó–∞–Ω—è—Ç–æ (–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞) |
| my | üî¥ –∫—Ä–∞—Å–Ω—ã–π —Å –±–æ—Ä–¥—é—Ä–æ–º | –ú–æ—è –±—Ä–æ–Ω—å (–∏–∑ localStorage) |

### –í—ã–±–æ—Ä —Å–µ–∫—Ü–∏–∏
- 12 –∫–Ω–æ–ø–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "–°–µ–∫—Ü–∏—è X"
- –ê–∫—Ç–∏–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è –ø–æ–¥—Å–≤–µ—á–µ–Ω–∞
- –£–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ (5 –∫–≤. / 6 –∫–≤.)

### –ß–µ—Ä—Ç–µ–∂–∏ —Å–µ–∫—Ü–∏–∏
- –ü–æ–∫–∞–∑–∞–Ω—ã —Å—Ä–∞–∑—É –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (2 thumbnails)
- –ö–ª–∏–∫ –Ω–∞ thumbnail ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç fullscreen preview
- Preview: –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω—ã–π —Ñ–æ–Ω, —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫—Ä–µ—Å—Ç–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (3 –∫–æ–ª–æ–Ω–∫–∏)
- –í—Å–µ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä (–≥–æ–ª—É–±–æ–π border)
- –°–≤–æ–±–æ–¥–Ω–æ (–∑–µ–ª—ë–Ω—ã–π border)
- –ó–∞–Ω—è—Ç–æ (–∫—Ä–∞—Å–Ω—ã–π border)

### –§–∏–ª—å—Ç—Ä—ã
- –≠—Ç–∞–∂: select (–í—Å–µ / 1-15 –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ–∫—Ü–∏–∏)
- –°—Ç–∞—Ç—É—Å: select (–õ—é–±–æ–π / –°–≤–æ–±–æ–¥–Ω–æ / –ó–∞–Ω—è—Ç–æ)

### –°–µ—Ç–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä
- –ö–æ—Ä–∏–¥–æ—Ä —Å–≤–µ—Ä—Ö—É (–ø–æ–ª–æ—Å–∞)
- –ö–≤–∞—Ä—Ç–∏—Ä—ã —Ä—è–¥–∞–º–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ = 5 –∏–ª–∏ 6 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ–∫—Ü–∏–∏)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —á–µ—Ä—Ç–µ–∂–µ–π
- –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ä–∞–∑–±–æ—Ä–∞ —á–µ—Ä—Ç–µ–∂–µ–π –≤ `context.md`
- –ü–ª–æ—â–∞–¥–∏ –∫–≤–∞—Ä—Ç–∏—Ä —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏–∏
- –ö–ª–∞—Å—Å—ã (–ê, –ë, –í, –ì) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø–ª–æ—â–∞–¥–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã: area √ó 130000

### 2. –ß–µ—Ä—Ç–µ–∂–∏
- –§–∞–π–ª—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –∏–∑ `/plan-zdaniya/schemaImages/` –≤ `/public/schemaImages/`
- –ú–∞–ø–ø–∏–Ω–≥ —Å–µ–∫—Ü–∏—è ‚Üí —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `sectionImages`
- Thumbnails (300px height) + fullscreen preview

### 3. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (localStorage)
```typescript
localStorage.setItem("apartmentPurchases", JSON.stringify({ "1-5-3": "–ò–≤–∞–Ω" }))
```
- –ö–ª—é—á: id –∫–≤–∞—Ä—Ç–∏—Ä—ã (section-floor-number)
- –ó–Ω–∞—á–µ–Ω–∏–µ: –∏–º—è –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –±—Ä–∞—É–∑–µ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. –°—Ç–∞—Ç—É—Å –ª–æ–≥–∏–∫–∞
```typescript
const status = purchases[apt.id] ? "my" : apt.status;
// "my" ‚Üí –∫—Ä–∞—Å–Ω—ã–π —Å –∏–º–µ–Ω–µ–º
// "free" ‚Üí –∑–µ–ª—ë–Ω—ã–π
// "sold" ‚Üí –∫—Ä–∞—Å–Ω—ã–π
```

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏
1. User –∫–ª–∏–∫–∞–µ—Ç "–°–µ–∫—Ü–∏—è 2"
2. `selectedSection` = "2"
3. `floorOptions` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–∂–µ–π (1-15)
4. `filteredFloors` ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
5. UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –∏ —á–µ—Ä—Ç–µ–∂–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä—Ç–µ–∂–µ–π
1. –ß–µ—Ä—Ç–µ–∂–∏ –ø–æ–∫–∞–∑–∞–Ω—ã —Å—Ä–∞–∑—É (thumbnail, 300px height)
2. User –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ thumbnail
3. `selectedSchema` = "firstFloor" | "typicalFloor"
4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
5. –ö–ª–∏–∫ –≤–Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –∫—Ä–µ—Å—Ç–∏–∫ ‚Üí –∑–∞–∫—Ä—ã—Ç–∏–µ

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
1. User –∫–ª–∏–∫–∞–µ—Ç –∑–µ–ª—ë–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Üí `handleApartmentClick()`
2. –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí –¥–µ—Ç–∞–ª–∏ + –∫–Ω–æ–ø–∫–∞ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
3. User –≤–≤–æ–¥–∏—Ç –∏–º—è ‚Üí `handlePurchase()` ‚Üí localStorage
4. UI: –∫–≤–∞—Ä—Ç–∏—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–∫—Ä–∞—Å–Ω–æ–π" —Å –∏–º–µ–Ω–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
1. State: `selectedSection`, `selectedFloor`, `selectedStatus`
2. `filteredFloors` (useMemo) ‚Üí —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç apartmentsData
3. –†–µ–Ω–¥–µ—Ä —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö —ç—Ç–∞–∂–µ–π